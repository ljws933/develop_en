<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.4.0 (https://qwtel.com/hydejack/)
--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta http-equiv="content-language" content="ko"><meta property="og:title" content="How to get Notification authorization on Android 13 and what changes."><meta property="og:type" content="article"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-VWWVVSTWY7"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-VWWVVSTWY7'); </script><link rel="stylesheet" type="text/css" href="/assets/css/linkpreview.css" media="screen"><meta property="og:image" content="https://mmol93-developer.com/assets/img/logo.png"><meta property="og:image:width" content="640" /><meta property="og:image:height" content="360" /><title>How to get Notification authorization on Android 13 and what changes. &middot; Mmol93 Developer</title><meta name="description" content="Let’s use DebugView to test the analogics of Firebase for debugging. This allows users to see when they used the app, which screen they saw, and which button they clicked on. It even tells you when you deleted the app. "><meta property="og:description" content="Let’s use DebugView to test the analogics of Firebase for debugging. This allows users to see when they used the app, which screen they saw, and which button they clicked on. It even tells you when you deleted the app. "><link rel="stylesheet" href="/assets/tipuesearch/css/tipuesearch.css"> <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="canonical" href="https://mmol93-developer.com/android/2023/01/17/notification-permission/"><meta property="og:url" content="https://mmol93-developer.com/android/2023/01/17/notification-permission/"><link rel="alternate" type="application/atom+xml" title="Mmol93 Developer Feed" href="https://mmol93-developer.com/feed.xml"><link rel="prev" href="https://mmol93-developer.com/kotlin/2023/01/16/kotlin-scope-function/"><link rel="next" href="https://mmol93-developer.com/android/2023/01/19/library-jitpack/"><link rel="apple-touch-icon" href="https://mmol93-developer.com/apple-touch-icon.png"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?"> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(e){"use strict";var n=function(n,t,o){function i(e){if(a.body)return e();setTimeout(function(){i(e)})}function r(){l.addEventListener&&l.removeEventListener("load",r),l.media=o||"all"}var d,a=e.document,l=a.createElement("link");if(t)d=t;else{var f=(a.body||a.getElementsByTagName("head")[0]).childNodes;d=f[f.length-1]}var s=a.styleSheets;l.rel="stylesheet",l.href=n,l.media="only x",i(function(){d.parentNode.insertBefore(l,t?d:d.nextSibling)});var u=function(e){for(var n=l.href,t=s.length;t--;)if(s[t].href===n)return e();setTimeout(function(){u(e)})};return l.addEventListener&&l.addEventListener("load",r),l.onloadcssdefined=u,u(r),l};"undefined"!=typeof exports?exports.loadCSS=n:e.loadCSS=n}("undefined"!=typeof global?global:this); !function(t){if(t.loadCSS){var e=loadCSS.relpreload={};if(e.support=function(){try{return t.document.createElement("link").relList.supports("preload")}catch(t){return!1}},e.poly=function(){for(var e=t.document.getElementsByTagName("link"),r=0;r<e.length;r++){var n=e[r];"preload"===n.rel&&"style"===n.getAttribute("as")&&(t.loadCSS(n.href,n,n.getAttribute("media")),n.rel=null)}},!e.support()){e.poly();var r=t.setInterval(e.poly,300);t.addEventListener&&t.addEventListener("load",function(){e.poly(),t.clearInterval(r)}),t.attachEvent&&t.attachEvent("onload",function(){t.clearInterval(r)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="https://unpkg.com/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----><style> article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:#333;background-color:#fff;overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}img,.img{display:block;max-width:100%;margin-bottom:1rem;border:none}img.lead,.img.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-weight:bold;text-rendering:optimizeLegibility}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{margin:1.6rem 0 1rem;line-height:1.6}h1,.h1{font-size:2rem;line-height:1.25}h2,.h2{font-size:1.5rem}h3,.h3{font-size:1.17em}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.25rem;font-weight:300;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:3px solid #eee}.hr{padding-bottom:.5rem;border-bottom:1px solid #eee;margin-bottom:1.5rem}h4,h5,h6,.h4,.h5,.h6{margin-bottom:0.5rem;font-size:1rem}table{margin-bottom:1rem;width:100%;width:calc(100% + 2rem);margin-left:-1rem;border:1px solid #e5e5e5;border-collapse:collapse;border-spacing:0}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}td:first-child,th:first-child{padding-left:1rem}td:last-child,th:last-child{padding-right:1rem}thead+tbody,tbody+tbody,tfoot{border-top:3px double #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}footer{margin-bottom:2rem}.page,.post{margin-bottom:3em}.page li+li,.post li+li{margin-top:.25rem}.page>header,.post>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a}.related-posts{padding-left:0;list-style:none}.related-posts>li,.related-posts>li+li{margin-top:1rem}.related-posts>li>small,.related-posts>li+li>small{font-size:75%;color:#9a9a9a}.message{margin-bottom:1rem;padding:1rem;color:#787878;background-color:#f9f9f9;margin-left:-1rem;margin-right:-1rem}body,main{position:relative;overflow-x:hidden}@media screen{body::before{content:'';background:#e5e5e5;position:absolute;left:0;top:0;bottom:0}}@media screen and (min-width: 40em){html{font-size:17px}}@media screen and (min-width: 54em){html{font-size:16px}}@media screen and (min-width: 88em){html{font-size:17px}}@media screen and (min-width: 125em){html{font-size:18px}}.sr-only{display:none}.clearfix,.sidebar-social::after,.clearafter::after{content:"";display:table;clear:both}a,.a{position:relative;padding-bottom:.15rem;border-style:hidden}.img{overflow:hidden;background-color:#f9f9f9}.img>img{margin:0;width:100%;height:100%}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}h1+hr,h2+hr,h3+hr,h4+hr,h5+hr,h6+hr{margin-top:0}.fade-in{animation-duration:500ms;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-2rem);opacity:0}50%{transform:translateY(-2rem);opacity:0}to{transform:translateY(0);opacity:1}}.mb6{margin-bottom:10rem}.sidebar{color:rgba(255,255,255,0.75);text-align:left}.sidebar::before{content:"";position:absolute;z-index:2;top:0;left:0;bottom:0;right:0;background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 100%)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.right-side{width:100%;margin-left:auto;margin-right:auto}.right-side .ad-first{text-align:center}@media screen{.right-side{max-width:38rem;min-height:100vh}.right-side .ad-second{display:none}}@media screen and (min-width: 54em){.right-side{margin-left:20rem;margin-right:1rem;padding:4rem 1rem 12rem}.right-side .ad-second{text-align:center;display:block}}@media screen and (min-width: 72em){.right-side{margin-left:22rem;max-width:42rem}}@media screen and (min-width: 88em){.right-side{width:162px;margin-left:0rem;margin-right:0rem;padding:0rem;margin-top:10rem;display:block;float:left}}@media screen and (min-width: 96em){.right-side{width:300px;margin-right:0rem}}#_yDrawer{position:relative}@media screen{#_yDrawer{min-height:640px;min-height:100vh}}@media screen and (min-width: 54em){#_yDrawer{width:18rem;margin-left:0}}.sidebar-bg{position:absolute;height:100%;overflow:hidden;top:0;right:0;bottom:0;left:0;background:#202020 center / cover}.sidebar-box{display:flex;justify-content:center}.sidebar-sticky{position:relative;z-index:3}@media screen{.sidebar-sticky{-ms-overflow-style:none;overflow:-moz-scrollbars-none;height:100%;overflow:auto;position:absolute;padding:3rem 0rem;right:2.5rem;left:2.5rem}}.sidebar-sticky::-webkit-scrollbar{display:none}.sidebar-about>h1{color:#fff;font-size:2rem}.sidebar-nav>ul{list-style:none;padding-left:0;margin-bottom:.5rem}a.sidebar-nav-item{width:100%;font-weight:medium;display:block;color:#ffffff;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}a.sidebar-nav-subitem{font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}@media screen{.y-drawer-scrim{z-index:2}.y-drawer-content{width:18rem;left:-18rem;z-index:3}}.sidebar-social{margin-bottom:.5rem}.sidebar-social>ul{list-style:none;padding-left:0;margin:0 -.25rem}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.6rem;line-height:3rem;width:3.1249rem;height:4rem;padding:.5rem 0}.sidebar-social>ul li+li{margin-top:0}.fixed-top{position:fixed;top:0;left:0;width:100%;z-index:1}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;height:0}.menu{display:inline-block;padding:1.75rem 1.5rem;border-bottom:none;margin-left:-1.5rem;color:#9a9a9a !important}.menu::after{content:"\2630"}@media screen and (min-width: 54em){.menu{padding:1.25rem 1.5rem;position:absolute;left:-9999px}.menu:focus{position:static}}.animation-main{pointer-events:none}.loading{display:none}@media print{.menu{display:none}}.animation-main{opacity:0;will-change:opacity}.loading{position:absolute;top:0;right:0;padding:5.25rem 4.5rem;transform-origin:top right;transform:scale(0.33)}.content{position:relative;margin-left:auto;margin-right:auto;padding:5rem 1rem 12rem}@media screen{.content{min-height:100vh}}@media screen and (min-width: 54em){.content{padding:4rem 1rem 12rem;margin-left:19rem;margin-right:3rem}}@media screen and (min-width: 72em){.content{max-width:42rem;margin-left:21rem}}@media screen and (min-width: 88em){.content{float:left;width:100%;margin-left:22rem;margin-right:5rem}}@media screen and (min-width: 96em){.content{max-width:44rem}}@media screen and (min-width: 102em){.content{margin-left:25rem;margin-right:8rem}}.me{width:6.5rem;height:6.5rem;align-self:center;margin-right:20px;border-radius:100%;position:relative}@media screen and (min-width: 40em){.me{width:7rem;height:7rem}}@media screen and (min-width: 54em){.me{width:6.5rem;height:6.5rem}}@media screen and (min-width: 72em){.me{width:7rem;height:7rem}}main>footer{width:100%;position:absolute;bottom:0;left:0;right:0;padding:0 1rem;color:#9a9a9a;font-size:smaller;text-align:center}main>footer>p{margin-bottom:0}html{font-family:'Lato','-apple-system','Verdana','PingFang SC','Helvetica Neue','Arial','Hiragino Sans GB','Microsoft YaHei','WenQuanYi Micro Hei','sans-serif'}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:'Lato','-apple-system','Verdana','PingFang SC','Helvetica Neue','Arial','Hiragino Sans GB','Microsoft YaHei','WenQuanYi Micro Hei','sans-serif'}</style><link rel="preload" href="https://mmol93-developer.com/assets/css/hydejack.css?v=6.4.0" as="style" onload="this.rel='stylesheet'"><style id="_pageStyle"> .content a{color:#4f86aa;border-color:rgba(79,134,170,0.2)}.content a:hover{border-color:#4f86aa}:focus{outline-color:#4f86aa}::selection{color:#fff;background:#4f86aa}::-moz-selection{color:#fff;background:#4f86aa}</style><noscript><link rel="stylesheet" href="https://mmol93-developer.com/assets/css/hydejack.css?v=6.4.0"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"><style> html { font-family: 'Merriweather-Light','Lato','-apple-system','Verdana','PingFang SC','Helvetica Neue','Arial','Hiragino Sans GB','Microsoft YaHei','WenQuanYi Micro Hei','sans-serif' } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Merriweather-Light','Lato','-apple-system','Verdana','PingFang SC','Helvetica Neue','Arial','Hiragino Sans GB','Microsoft YaHei','WenQuanYi Micro Hei','sans-serif' }</style><link rel="stylesheet" href="https://mmol93-developer.com/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "BlogPosting", "description": "Let’s use DebugView to test the analogics of Firebase for debugging. This allows users to see when they used the app, which screen they saw, and which button they clicked on. It even tells you when you deleted the app. ", "datePublished": "2023-01-17 00:00:00 +0000", "headline": "How to get Notification authorization on Android 13 and what changes.", "url": "https://mmol93-developer.com/android/2023/01/17/notification-permission/", "mainEntityOfPage":{ "@id":"https://mmol93-developer.com/android/2023/01/17/notification-permission/", "name":null }, "author": [ { "@type": "Person", "name": "Mmol93", "url": "https://https://mmol93-developer.com/" } ] } </script><body><div class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a></div></div><div id="_yPushState"><div class="fade-in"><main id="_main" class="content" role="main" data-color="#4f86aa" data-image="/assets/img/main_left.jpg"><article id="post-android/2023/01/17/notification-permission" class="post" role="article"><header><h1 class="post-title"> How to get Notification authorization on Android 13 and what changes.</h1><p class="post-date heading"> <time datetime="2023-01-17T00:00:00+00:00">17 Jan 2023</time> in <a href="/category/android/" data-flip="title">Android</a> on <a href="/tag/android/" data-flip="title">Android(Kotlin)</a></header><div class="markdown-body"><style> .googleads { display:block; width:98%; height: 280px; } @media(min-width: 600px) { .googleads { display: none; } }</style><br/><h3 id="changes-in-notification-in-android-13"><strong>Changes in Notification in Android 13</strong></h3><ul><li>POST_NOTIFICATIONS (Notification Permission) can be added from Target SDK API 33 or higher<li>If an app with Target SDK API 32 or lower is installed on an Android 13 device, the Notification permission request popup will appear <strong>automatically</strong> when registering a Notification Channel<li>If an app with Target SDK API 33 or higher is installed on an Android 13 device, the Notification permission request can be displayed at the <strong>developer’s desired timing</strong><li>If an app with Target SDK API 33 or higher is installed on an Android 12 or lower device, it can be used without requesting the Notification permission as before<li>If an API 32 app is updated to 33 and the user has already agreed to the notification permission, it will be allowed by default after the update, but there are exceptions<ul><li>There may be cases where it is not automatically allowed depending on the device and you need to request permission again<li>Therefore, it is recommended to include a check to see if the Notification permission is granted.</ul></ul><h2 id="cautions-for-notification-permission-request-popup"><strong>Cautions for Notification Permission Request Popup</strong></h2><ul><li>For apps with <strong>API 32 or lower</strong>, if the user presses the Don’t allow button when the system automatically displays the permission popup, the popup will not appear even if the app is restarted.<li>For apps with <strong>API 33 or higher</strong>, if the app displays the permission popup, it can continue to display the permission popup until the user presses the Don’t allow button <strong>twice</strong>.<li>If the user can no longer display the popup by pressing the Don’t allow button, they must go to the app settings and grant permission.</ul><hr /><h2 id="registering-the-app-as-needing-notification-permission"><strong>Registering the App as Needing Notification Permission</strong></h2><blockquote><p>AndroidManifest.xml</blockquote><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="n">manifest</span> <span class="o">..</span><span class="p">.&gt;</span>
    <span class="p">&lt;</span><span class="n">uses-permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.POST_NOTIFICATIONS"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">application</span> <span class="o">..</span><span class="p">.&gt;</span>
        <span class="o">..</span><span class="p">.</span>
    <span class="p">&lt;/</span><span class="n">application</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="n">manifest</span><span class="p">&gt;</span>

</code></pre></div></div><ol><li>Add the above permission to AndroidManifest.xml.<li>Perform “Sync project with gradle files”.</ol><hr /><h2 id="change-compilesdk-to-33"><strong>Change compileSdk to 33</strong></h2><ul><li>The compileSdk in the app-level build.gradle must be changed to 33<ul><li>The targetSdk also needs to be changed to 33</ul></ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">android</span> <span class="p">{</span>
    <span class="n">compileSdk</span> <span class="mi">33</span>

    <span class="nf">defaultConfig</span> <span class="p">{</span>
        <span class="n">applicationId</span> <span class="s">"com.example.selftest"</span>
        <span class="n">minSdk</span> <span class="mi">23</span>
        <span class="n">targetSdk</span> <span class="mi">33</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s">"1.0"</span>

        <span class="n">testInstrumentationRunner</span> <span class="s">"androidx.test.runner.AndroidJUnitRunner"</span>
    <span class="p">}</span>

</code></pre></div></div><hr /><h2 id="defining-notification"><strong>Defining Notification</strong></h2><ul><li>Define the Notification Channel and Builder for the Notification<ul><li>From SDK version 26 or higher, a channel must be defined to use Notification<li>Send Notification using the Builder</ul></ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">makeAlarmNotification</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">messageBody</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">Timber</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"make notification"</span><span class="p">)</span>
    <span class="c1">// Open MainActivity when notification is clickedval intent = Intent(context, MainActivity::class.java)</span>
    <span class="n">intent</span><span class="p">.</span><span class="n">flags</span> <span class="p">=</span> <span class="nc">Intent</span><span class="p">.</span><span class="nc">FLAG_ACTIVITY_CLEAR_TASK</span> <span class="n">or</span> <span class="nc">Intent</span><span class="p">.</span><span class="nc">FLAG_ACTIVITY_NEW_TASK</span>
    <span class="kd">val</span> <span class="py">pendingIntent</span> <span class="p">=</span> <span class="nc">PendingIntent</span><span class="p">.</span><span class="nf">getActivity</span><span class="p">(</span>
        <span class="n">context</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">intent</span><span class="p">,</span>
        <span class="nc">PendingIntent</span><span class="p">.</span><span class="nc">FLAG_UPDATE_CURRENT</span> <span class="n">or</span> <span class="nc">PendingIntent</span><span class="p">.</span><span class="nc">FLAG_IMMUTABLE</span>
    <span class="p">)</span>

    <span class="c1">// Define the Notification channel idval channelId = "channel1"</span>
    <span class="kd">val</span> <span class="py">channelName</span> <span class="p">=</span> <span class="s">"channel name"</span>

        <span class="c1">// Define the Notificationval notificationBuilder = NotificationCompat.Builder(context, channelId)</span>
        <span class="p">.</span><span class="nf">setSmallIcon</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_bottom_menu_search</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setContentTitle</span><span class="p">(</span><span class="s">"notification title"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setContentText</span><span class="p">(</span><span class="n">messageBody</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setAutoCancel</span><span class="p">(</span><span class="k">false</span><span class="p">)</span><span class="c1">// Prevent it from being deleted completely</span>
        <span class="p">.</span><span class="nf">setSound</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setContentIntent</span><span class="p">(</span><span class="n">pendingIntent</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setPriority</span><span class="p">(</span><span class="nc">NotificationCompat</span><span class="p">.</span><span class="nc">PRIORITY_DEFAULT</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setOngoing</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="c1">// Keep the alarm on</span>

        <span class="c1">// Create the Notification using the defined content and channelval notificationManager =</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="nc">Context</span><span class="p">.</span><span class="nc">NOTIFICATION_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="nc">NotificationManager</span>

        <span class="c1">// A channel must be specified when creating a notification for Android SDK 26 or higherif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {</span>
        <span class="kd">val</span> <span class="py">channel</span> <span class="p">=</span> <span class="nc">NotificationChannel</span><span class="p">(</span>
            <span class="n">channelId</span><span class="p">,</span>
            <span class="n">channelName</span><span class="p">,</span>
            <span class="nc">NotificationManager</span><span class="p">.</span><span class="nc">IMPORTANCE_DEFAULT</span>
        <span class="p">)</span>
        <span class="n">notificationManager</span><span class="p">.</span><span class="nf">createNotificationChannel</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1">// Show the Notification</span>
    <span class="n">notificationManager</span><span class="p">.</span><span class="nf">notify</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">notificationBuilder</span><span class="p">.</span><span class="nf">build</span><span class="p">())</span>
<span class="p">}</span>

</code></pre></div></div><hr /><h2 id="getting-notification-permission"><strong>Getting Notification Permission</strong></h2><p>To display a Notification in Android 13 or higher, you must request and obtain permission.<p>Notification permissions can be obtained in the following ways.<blockquote><p>FirstFragment.kt</blockquote><p>Display the Notification permission request popup when the button is pressed.<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FirstFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">DENIED</span> <span class="p">=</span> <span class="s">"denied"</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">EXPLAINED</span> <span class="p">=</span> <span class="s">"explained"</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">FragmentFirstBinding</span> <span class="k">by</span> <span class="nf">autoCleared</span><span class="p">()</span>
        <span class="c1">// Create an Activity Callback object for permission requestsprivate </span>
        <span class="kd">val</span> <span class="py">registerForActivityResult</span> <span class="p">=</span> <span class="nf">registerForActivityResult</span><span class="p">(</span><span class="nc">ActivityResultContracts</span><span class="p">.</span><span class="nc">RequestMultiplePermissions</span><span class="p">())</span> <span class="p">{</span> <span class="n">permissions</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">deniedPermissionList</span> <span class="p">=</span> <span class="n">permissions</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="p">!</span><span class="n">it</span><span class="p">.</span><span class="n">value</span> <span class="p">}.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">key</span> <span class="p">}</span>
            <span class="k">when</span> <span class="p">{</span>
                <span class="n">deniedPermissionList</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">map</span> <span class="p">=</span> <span class="n">deniedPermissionList</span><span class="p">.</span><span class="nf">groupBy</span> <span class="p">{</span> <span class="n">permission</span> <span class="p">-&gt;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nf">shouldShowRequestPermissionRationale</span><span class="p">(</span><span class="n">permission</span><span class="p">))</span> <span class="nc">DENIED</span> <span class="k">else</span> <span class="nc">EXPLAINED</span>
                    <span class="p">}</span>
                    <span class="n">map</span><span class="p">[</span><span class="nc">DENIED</span><span class="p">]</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
                        <span class="c1">// When permission is simply denied</span>
                    <span class="p">}</span>
                    <span class="n">map</span><span class="p">[</span><span class="nc">EXPLAINED</span><span class="p">]</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
                        <span class="c1">// When the permission request is completely blocked (usually open the app details screen)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="c1">// When all permissions are allowed</span>
                <span class="p">}</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreateView</span><span class="p">(</span>
        <span class="n">inflater</span><span class="p">:</span> <span class="nc">LayoutInflater</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="nc">ViewGroup</span><span class="p">?,</span>
        <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?</span>
    <span class="p">):</span> <span class="nc">View</span> <span class="p">{</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">FragmentFirstBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">binding</span><span class="p">.</span><span class="n">root</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="nc">View</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="nf">setOnClickListener</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">action</span> <span class="p">=</span> <span class="nc">FirstFragmentDirections</span><span class="p">.</span><span class="nf">actionFirstFragmentToThirdFragment</span><span class="p">()</span>
            <span class="nf">findNavController</span><span class="p">().</span><span class="nf">navigate</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// Request Notification permission when the button is clicked</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">freeButton</span><span class="p">.</span><span class="nf">setOnSingleClickListener</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">&gt;=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">TIRAMISU</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">registerForActivityResult</span><span class="p">.</span><span class="nf">launch</span><span class="p">(</span>
                    <span class="nf">arrayOf</span><span class="p">(</span><span class="nc">Manifest</span><span class="p">.</span><span class="n">permission</span><span class="p">.</span><span class="nc">POST_NOTIFICATIONS</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">}</span>
            <span class="nf">makeAlarmNotification</span><span class="p">(</span><span class="nf">requireContext</span><span class="p">(),</span> <span class="s">"notification"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div><p>This method can be used not only in Fragment but also in Activity.<hr /><h2 id="summary"><strong>Summary</strong></h2><ul><li>For <strong>existing apps</strong>, the window for requesting permission automatically appears when registering a Notification Channel.<ul><li>However, if permission is not granted at this stage, permission cannot be requested twice.</ul><li>If you have set SDK 33 or higher as the target, you must include a feature that requests permission.</ul><br/> <br/></div><script> </script></article><hr class="dingbat" /> <br/><aside class="donation" role="complementary"><h2 class="hr"></h2><script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="kkol" data-color="#FFDD00" data-emoji="" data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script></aside><aside class="author" role="complementary"><div class="author"><h2 class="page-title hr"> About</h2><div class="author-body"> <img src="/assets/img/white.png" class="me" alt="Mmol93" srcset="/assets/img/white.png 1x,/assets/img/white.png 2x" /><div class="author-body-description"><p>Software for automation.</div></div></div></aside><aside class="related" role="complementary"><h2 class="hr">Related Posts</h2><ul class="related-posts"><li class="h4"> <a href="/android/2023/03/30/mvvm-viewModel-event-2/" data-flip="title"> <span>How can I get viewModel event with MVVM - 2</span> </a> <small><time datetime="2023-03-30T00:00:00+00:00"> 30 Mar 2023 </time></small><li class="h4"> <a href="/android/2023/03/26/mvvm-viewModel-event-1/" data-flip="title"> <span>How can I get viewModel event with MVVM - 1</span> </a> <small><time datetime="2023-03-26T00:00:00+00:00"> 26 Mar 2023 </time></small><li class="h4"> <a href="/android/2023/03/21/android-aac/" data-flip="title"> <span>What is an essential AAC for using Android MVVM?</span> </a> <small><time datetime="2023-03-21T00:00:00+00:00"> 21 Mar 2023 </time></small><li class="h4"> <a href="/android/2023/03/17/android-mvvm/" data-flip="title"> <span>what is Android MVVM architecture and why it is needed?</span> </a> <small><time datetime="2023-03-17T00:00:00+00:00"> 17 Mar 2023 </time></small><li class="h4"> <a href="/android/2023/03/16/broadcast-test/" data-flip="title"> <span>Android Kotlin Braodcast Receiver test - for beginner</span> </a> <small><time datetime="2023-03-16T00:00:00+00:00"> 16 Mar 2023 </time></small></ul></aside><aside class="comments" role="complementary"><h2>Comments</h2><hr/><div id="disqus_thread"></div><script> !function(s,i){function e(e){var t=s.pageYOffset||i.body.scrollTop;s.DISQUS&&!s._disqusThis&&!s._disqusFirst&&t+s.innerHeight>=s._disqusThreadOffsetTop&&(s._disqusThis=!0,s.DISQUS.reset({reload:!0,config:d}))}var d=function(){this.page.title="How to get Notification authorization on Android 13 and what changes.",this.page.identifier="/android/2023/01/17/notification-permission",this.page.url="https://mmol93-developer.com/android/2023/01/17/notification-permission/"};s._disqusFirst=void 0===s._disqusFirst||s._disqusFirst,s._disqusLoading=void 0!==s._disqusLoading&&s._disqusLoading,s._disqusThis=!1,s._disqusThreadOffsetTop=i.getElementById("disqus_thread").offsetTop,s._disqusLoading?s._disqusFirst=!1:(s._disqusLoading=!0,loadJSDeferred("//japan-culture-blog.disqus.com/embed.js"),s.addEventListener?s.addEventListener("scroll",e,{passive:!0}):s.attachEvent?s.attachEvent("onscroll",e):s.onscroll=e)}(window,document); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></aside><footer><hr/><p>© 2023.03. by Mmol93<p> <code>Powered by <a href="https://github.com/mmol93">Mmol93</a></code></footer></main><div class="right-side"> <br/> <br/><div class="ad-second"> <ins class="adsbygoogle" style="display:inline-block;max-width:320px;width:100%;height:600px" data-ad-client="ca-pub-1200017190012992"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div></div><div id="_yDrawer"><div id="_sidebar" class="sidebar"><div class="sidebar-bg" style="background-color:#4f86aa;background-image:url(/assets/img/main_left.jpg)"></div><header class="sidebar-sticky" role="banner"> <br/><div class="sidebar-about"><h1><a id="_title" href="/">Mmol93 Developer</a></h1><p>Android developer Story</div><br/> <br/><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <input type="checkbox" id="list-item-1"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/category/diary/">Diary & IT</a></div><ul class="list-body"></ul><li> <input type="checkbox" id="list-item-2"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/category/android/">Android</a> <label class="folder" for="list-item-2">▾</label></div><ul class="list-body"><li> <a class="sidebar-nav-subitem" href="/tag/android/">Android(Kotlin)</a><li> <a class="sidebar-nav-subitem" href="/tag/rx-android/">Rx-Android</a></ul><li> <input type="checkbox" id="list-item-3"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/category/rx-android/">Ruby</a></div><ul class="list-body"></ul><li> <input type="checkbox" id="list-item-4"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/category/kotlin/">Kotlin</a></div><ul class="list-body"></ul><li> <input type="checkbox" id="list-item-5"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/category/flutter/">Algorithm(Kotlin)</a></div><ul class="list-body"></ul><li> <input type="checkbox" id="list-item-6"/><div class="list-wrapper"> <a class="sidebar-nav-item" href="/about/">About</a></div><ul class="list-body"></ul></ul></nav><br/> <form action="/search"><div class="tipue_search_left"> <img src="/assets/tipuesearch/search.png" class="tipue_search_icon"></div><div class="tipue_search_right"> <input type="text" name="q" id="tipue_search_input" pattern=".{1,}" title="At least 1 characters" required></div><div style="clear: both;"></div></form> <br/><div class="sidebar-box"> <img src="/assets/img/white.png" class="me" alt="Mmol93" srcset="/assets/img/white.png 1x,/assets/img/white.png 2x" /></div><p>Software is for automation.<div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/mmol93"> <span class="icon-github" title="GitHub"></span> <span class="sr-only">GitHub</span> </a></ul></div></header></div></div></div><script> window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; ga('create', '358840206', 'auto'); ga('send', 'pageview'); loadJSDeferred('https://www.google-analytics.com/analytics.js'); </script> <!--[if gt IE 8]><!----> <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script> <script> WebFont.load({ google: { families: 'Lato'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }); </script> <!--<![endif]--> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.4.0');</script> <!--<![endif]--> <a href="#" id="gotop" style="position:fixed;bottom:10px;right:10px;z-index:99999999" title="Top"><img src="/assets/img/up.png" border="0"/></a>
</html>
